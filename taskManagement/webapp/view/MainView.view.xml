<mvc:View
    controllerName="taskManagement.controller.MainView"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns="sap.m"
    displayBlock="true"
    height="100%"
    busyIndicatorDelay="0"
>
    <SplitApp
        id="managerSplitApp"
        initialMaster="masterPage"
        initialDetail="detailPage"
        xmlns:data="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
    >
        <masterPages>
            <Page id="masterPage">
                <content>
                    <FlexBox
                        alignItems="Center"
                        direction="Column"
                        height="100%"
                    >
                        <core:Fragment
                            fragmentName="taskManagement.view.fragments.Sidebar"
                            type="XML"
                        />
                    </FlexBox>
                </content>
            </Page>
        </masterPages>
        <detailPages>
            <Page id="detailPage">
                <customHeader>
                    <OverflowToolbar>
                        <Button
                            icon="sap-icon://nav-back"
                            type="Transparent"
                            press="onNavBack"
                            visible="{pageModel>/navBackVisible}"
                            class="sapUiHideOnDesktop sapUiHideOnTablet"
                        />
                        <ToolbarSpacer />
                        <Title
                            text="{i18n>pageTitle}"
                            level="H2"
                        />
                        <ToolbarSpacer />
                        <Avatar initials="Js" press="onUserInfoPress" displaySize="XS" backgroundColor="Accent6" tooltip="{i18n>text.userInfo}"/>
                    </OverflowToolbar>
                </customHeader>
        <content>
            <VBox class ="sapUiMediumMarginTop">
                <!-- Search and Filter Bar -->
                <Toolbar>
                    <SearchField id="titleSearchField" width="30%" placeholder="{i18n>placeholder.searchByTitle}" value="{filterModel>/titleQuery}" search="onSearch" liveChange="onSearch"/>
                    <SearchField id="employeeSearchField" width="30%" placeholder="{i18n>placeholder.searchByEmployee}" value="{filterModel>/employeeQuery}" search="onSearch" liveChange="onSearch" class="sapUiSmallMarginBegin"/>
                    <ToolbarSpacer/>
                    <Select
                        id="typeFilter"
                        selectedKey="{filterModel>/typeFilter}"
                        change="onTypeFilter">
                        <items>
                            <core:Item key="all" text="{i18n>filter.allTypes}"/>
                            <core:Item key="Travel" text="{i18n>filter.type.travel}"/>
                            <core:Item key="Equipment" text="{i18n>filter.type.equipment}"/>
                        </items>
                    </Select>
                </Toolbar>
                
                <!-- Table -->
                <Table
                    id="requestsTable"
                    items="{/filteredRequests}"
                    mode="None">
                    <columns>
                        <Column><Text text="{i18n>label.title}"/></Column>
                        <Column><Text text="{i18n>column.type}"/></Column>
                        <Column><Text text="{i18n>column.from}"/></Column>
                        <Column width="3rem" hAlign="Center"><Text text="{i18n>label.files}"/></Column>
                        <Column width="8rem" hAlign="Center"><Text text="{i18n>column.actions}"/></Column>
                    </columns>
                    <items>
                        <ColumnListItem type="Active" press="onItemPress">
                            <cells>
                                <Text text="{title}"/>
                                <ObjectStatus text="{path: 'type', formatter: '.formatter.formatRequestType'}" state="Information"/>
                                <Text text="{from}"/>
                                <core:Icon
                                    src="{= ${hasFiles} ? 'sap-icon://attachment' : 'sap-icon://document' }"
                                    color="{= ${hasFiles} ? '#007bff' : '#6c757d' }"/>
                                <HBox justifyContent="Center">
                                    <Button
                                        icon="sap-icon://accept"
                                        type="Accept"
                                        press="onApprove"
                                        class="sapUiTinyMarginEnd"/>
                                    <Button
                                        icon="sap-icon://decline"
                                        type="Reject"
                                        press="onReject"/>
                                </HBox>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
                
                <!-- Request Detail Section (shown on click) -->
<!-- Request Detail Section (shown on click) -->
                <Panel 
                    headerText="{i18n>title.requestDetails}"
                    expanded="{viewModel>/showDetail}"
                    expandable="true"
                    visible="{viewModel>/showDetail}"
                    class="sapUiMediumMarginTop">
                    <content>
                        <!-- Request ID -->
                        <VBox class="sapUiSmallMargin">
                            <HBox class="sapUiSmallMarginBottom">
                                <Label text="{i18n>column.requestId}" class="sapUiTinyMarginEnd"/>
                                <Text text="{viewModel>/selectedRequest/requestId}" class="sapUiTinyMarginBegin"/>
                            </HBox>
                            
                            <!-- Type and Status -->
                            <HBox class="sapUiSmallMarginBottom">
                                <Label text="{i18n>column.type}" class="sapUiTinyMarginEnd"/>
                                <ObjectStatus 
                                    text="{viewModel>/selectedRequest/type}"
                                    state="{= ${viewModel>/selectedRequest/type} === 'Travel' ? 'Success' : 'Information'}"
                                    class="sapUiTinyMarginBegin"/>
                                <Label text="{i18n>column.status}" class="sapUiMediumMarginBegin"/>
                                <ObjectStatus 
                                    text="{viewModel>/selectedRequest/status}"
                                    state="{= ${viewModel>/selectedRequest/status} === 'APPROVED' ? 'Success' : (${viewModel>/selectedRequest/status} === 'REJECTED' ? 'Error' : 'Warning')}"
                                    class="sapUiTinyMarginBegin"/>
                            </HBox>
                            
                            <!-- Submitted Date and From -->
                            <HBox class="sapUiSmallMarginBottom">
                                <Label text="{i18n>column.from}" class="sapUiTinyMarginEnd"/>
                                <Text text="{viewModel>/selectedRequest/from}" class="sapUiTinyMarginBegin"/>
                            </HBox>
                            
                            <!-- View Details Button -->
                            <HBox class="sapUiMediumMarginTop" justifyContent="Center">
                                <Button
                                    text="{i18n>button.viewDetails}"
                                    type="Emphasized"
                                    icon="sap-icon://detail-view"
                                    press="onViewDetails"
                                    class="sapUiTinyMargin"/>
                                <Button text="{i18n>button.close}" press="onCloseDetail" class="sapUiTinyMarginBegin"/>
                            </HBox>
                        </VBox>
                    </content>
                </Panel>
            </VBox>
        </content>
            </Page>
        </detailPages>
    </SplitApp>
</mvc:View>
