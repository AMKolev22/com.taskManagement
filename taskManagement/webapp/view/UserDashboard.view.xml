<mvc:View
    controllerName="taskManagement.controller.UserDashboard"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns="sap.m"
    displayBlock="true"
    height="100%"
>
    <SplitApp
        id="userSplitApp"
        initialMaster="masterPage"
        initialDetail="detailPage"
    >
        <masterPages>
            <Page id="masterPage">
                <content>
                    <FlexBox
                        alignItems="Center"
                        direction="Column"
                        height="100%"
                    >
                        <core:Fragment
                            fragmentName="taskManagement.view.fragments.Sidebar"
                            type="XML"
                        />
                    </FlexBox>
                </content>
            </Page>
        </masterPages>
        <detailPages>
            <Page id="detailPage">
                <customHeader>
                    <OverflowToolbar>
                        <Button
                            icon="sap-icon://nav-back"
                            type="Transparent"
                            press="onNavBack"
                            visible="{pageModel>/navBackVisible}"
                            class="sapUiHideOnDesktop sapUiHideOnTablet"
                        />
                        <ToolbarSpacer />
                        <Title text="{i18n>title.myDashboard}" level="H2"/>
                        <ToolbarSpacer />
                        <Button icon="sap-icon://refresh" tooltip="{i18n>tooltip.refresh}" press="onRefresh" type="Transparent"/>
                        <Avatar
                            initials="{= ${userModel>/currentUser/firstName}.charAt(0) + ${userModel>/currentUser/lastName}.charAt(0) }"
                            press="onUserInfoPress"
                            displaySize="XS"
                            backgroundColor="Accent6"
                            tooltip="{= ${userModel>/currentUser/firstName} + ' ' + ${userModel>/currentUser/lastName} }"
                        />
                    </OverflowToolbar>
                </customHeader>
                <content>
                    <VBox class="sapUiMediumMargin">
                        <!-- Welcome Section -->
                        <VBox class="sapUiMediumMarginBottom">
                            <Title text="{i18n>title.welcome}" level="H3" class="sapUiSmallMarginBottom"/>
                            <Text text="{i18n>text.overviewRecent}" />
                        </VBox>

                        <!-- Quick Actions -->
                        <HBox
                            justifyContent="Start"
                            class="sapUiMediumMarginBottom"
                        >
                            <Button text="{i18n>button.newVacationRequest}" icon="sap-icon://create-leave-request" type="Emphasized" press="onNewVacationRequest" class="sapUiTinyMarginEnd"/>
                            <Button text="{i18n>button.viewAllMyTasks}" icon="sap-icon://task" press="onViewAllTasks" class="sapUiTinyMarginEnd"/>
                        </HBox>

                        <!-- Recent Tasks Section -->
                        <Panel headerText="{i18n>title.recentRequests}" class="sapUiMediumMarginBottom">
                            <content>
                                <List id="recentTasksList" items="{dashboardModel>/recentTasks}" noDataText="{i18n>text.noRecentRequests}">
                                    <CustomListItem
                                        type="Active"
                                        press="onTaskPress"
                                    >
                                        <HBox
                                            justifyContent="SpaceBetween"
                                            alignItems="Center"
                                            width="100%"
                                            wrap="Wrap"
                                        >
                                            <HBox alignItems="Center">
                                                <layoutData>
                                                    <FlexItemData growFactor="1" />
                                                </layoutData>
                                                <core:Icon
                                                    src="{path: 'dashboardModel>type', formatter: '.formatter.getRequestTypeIcon'}"
                                                    color="{path: 'dashboardModel>type', formatter: '.formatter.getRequestTypeColor'}"
                                                    size="2rem"
                                                    class="sapUiTinyMarginEnd"
                                                />
                                                <VBox>
                                                    <HBox>
                                                        <Text
                                                            text="{dashboardModel>requestId}"
                                                            class="sapUiTinyMarginEnd"
                                                        />
                                                        <ObjectStatus text="{path: 'dashboardModel>type', formatter: '.formatter.formatRequestType'}" state="Information"/>
                                                    </HBox>
                                                    <Text
                                                        text="{dashboardModel>subject}"
                                                        class="sapUiTinyMarginTop"
                                                    />
                                                    <Text text="{= ${i18n>text.submittedPrefix}.replace('{0}', ${path: 'dashboardModel>submittedDate', formatter: '.formatter.formatDate'}) }" class="sapUiTinyMarginTop"/>
                                                </VBox>
                                            </HBox>
                                            <VBox alignItems="End">
                                                <layoutData>
                                                    <FlexItemData shrinkFactor="0" />
                                                </layoutData>
                                                <ObjectStatus
                                                    text="{path: 'dashboardModel>status', formatter: '.formatter.formatStatus'}"
                                                    state="{path: 'dashboardModel>status', formatter: '.formatter.formatStatusState'}"
                                                />
                                                <Button text="{i18n>button.viewDetails}" type="Transparent" press="onViewTaskDetails" class="sapUiTinyMarginTop"/>
                                            </VBox>
                                        </HBox>
                                    </CustomListItem>
                                </List>
                            </content>
                        </Panel>

                        <!-- Activity Log Fragment -->
                        <core:Fragment
                            fragmentName="taskManagement.view.fragments.ActivityLog"
                            type="XML"
                        />
                    </VBox>
                </content>
            </Page>
        </detailPages>
    </SplitApp>
</mvc:View>

