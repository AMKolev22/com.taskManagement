<mvc:View
    controllerName="taskManagement.controller.TravelCost"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.ui.layout.form"
    xmlns:u="sap.ui.unified"
    xmlns:core="sap.ui.core"
    xmlns:data="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
    displayBlock="true">
    <SplitApp
        id="managerSplitApp"
        initialMaster="masterPage"
        initialDetail="detailPage"
    >
        <masterPages>
            <Page id="masterPage">
                <content>
                    <FlexBox
                        alignItems="Center"
                        direction="Column"
                        height="100%"
                    >
                        <core:Fragment
                            fragmentName="taskManagement.view.fragments.Sidebar"
                            type="XML"
                        />
                    </FlexBox>
                </content>
            </Page>
        </masterPages>
        <detailPages>
            <Page id="detailPage">
                <customHeader>
                    <OverflowToolbar>
                        <Button
                            icon="sap-icon://nav-back"
                            type="Transparent"
                            press="onNavBack"
                            visible="{pageModel>/navBackVisible}"
                            class="sapUiHideOnDesktop sapUiHideOnTablet"
                        />
                        <ToolbarSpacer />
                        <Title
                            text="{i18n>pageTitle}"
                            level="H2"
                        />
                        <ToolbarSpacer />
                        <Avatar initials="Js" press="onUserInfoPress" displaySize="XS" backgroundColor="Accent6" tooltip="{i18n>text.userInfo}"/>
                    </OverflowToolbar>
                </customHeader>
                <content>
                    <VBox width="100%">
                        
                        <!-- Validation Message Strip -->
                        <MessageStrip
                            id="validationMessageStrip"
                            type="{/validationMessageType}"
                            showIcon="true"
                            visible="{/showValidationMessage}"
                            text="{/validationMessage}"
                            class="sapUiSmallMargin"
                        />
                        
                        <!-- Basic Information Section -->
                        <Panel headerText="{i18n>section.travelInformation}">
                            <f:SimpleForm
                                editable="true"
                                layout="ResponsiveGridLayout"
                                labelSpanXL="3"
                                labelSpanL="3"
                                labelSpanM="3"
                                labelSpanS="12"
                                emptySpanXL="4"
                                emptySpanL="4"
                                emptySpanM="4"
                                emptySpanS="0"
                                columnsXL="1"
                                columnsL="1"
                                columnsM="1">
                                <f:content>
                                    <Label text="{i18n>label.destination}" required="true"/>
                                    <Input 
                                        id="destinationInput"
                                        value="{/destination}" 
                                        placeholder="{i18n>placeholder.destination}"
                                        required="true"/>
                                    
                                    <Label text="{i18n>label.startDate}" required="true"/>
                                    <DatePicker 
                                        id="startDatePicker"
                                        value="{/startDate}"
                                        placeholder="{i18n>placeholder.startDate}"
                                        required="true"/>
                                    
                                    <Label text="{i18n>label.endDate}" required="true"/>
                                    <DatePicker 
                                        id="endDatePicker"
                                        value="{/endDate}"
                                        placeholder="Select end date"
                                        required="true"/>
                                    
                                    <Label text="Reason for Travel" required="true"/>
                                    <TextArea 
                                        id="reasonTextArea"
                                        value="{/reason}" 
                                        rows="4"
                                        placeholder="Describe the business purpose of your trip"
                                        required="true"/>
                                    
                                    <Label text="Approving Manager" required="true"/>
                                    <Select
                                        id="managerSelect"
                                        selectedKey="{/selectedManager}"
                                        items="{/managers}"
                                        required="true">
                                        <core:Item key="{key}" text="{name}"/>
                                    </Select>
                                </f:content>
                            </f:SimpleForm>
                        </Panel>

                        <!-- Food Costs Section -->
                        <Panel headerText="{i18n>title.foodCosts}">
                            <VBox class="sapUiSmallMargin">
                                <HBox justifyContent="SpaceBetween" alignItems="Center" class="sapUiTinyMarginBottom">
                                    <Label text="{i18n>text.uploadFoodHint}"/>
                                    <Button 
                                        text="{i18n>button.addFoodCost}" 
                                        icon="sap-icon://add"
                                        type="Emphasized"
                                        press=".onAddFile"
                                        data:category="foodCosts"
                                        tooltip="{i18n>tooltip.addFoodCost}"/>
                                </HBox>
                                <List 
                                    id="foodCostsList"
                                    items="{
                                        path: '/foodCosts',
                                        templateShareable: false
                                    }"
                                    noDataText="{i18n>text.noFoodCosts}">
                                    <CustomListItem>
                                        <HBox justifyContent="SpaceBetween" alignItems="Center" width="100%">
                                            <VBox width="80%">
                                                <Text text="{fileName}" class="sapUiTinyMarginBottom"/>
                                                <Text text="{description}" class="sapUiTinyText"/>
                                                <Text text="Size: {fileSize}" class="sapUiTinyText"/>
                                            </VBox>
                                            <Button 
                                                icon="sap-icon://delete" 
                                                type="Transparent"
                                                press=".onDeleteFile"
                                                data:category="foodCosts"
                                                data:index="{index}"
                                                tooltip="{i18n>tooltip.deleteFile}"/>
                                        </HBox>
                                    </CustomListItem>
                                </List>
                            </VBox>
                        </Panel>

                        <!-- Travel Costs Section -->
                        <Panel headerText="{i18n>title.travelCosts}" >
                            <VBox class="sapUiSmallMargin">
                                <HBox justifyContent="SpaceBetween" alignItems="Center" class="sapUiTinyMarginBottom">
                                    <Label text="{i18n>text.uploadTravelHint}"/>
                                    <Button 
                                        text="{i18n>button.addTravelCost}" 
                                        icon="sap-icon://add"
                                        type="Emphasized"
                                        press=".onAddFile"
                                        data:category="travelCosts"
                                        tooltip="{i18n>tooltip.addTravelCost}"/>
                                </HBox>
                                <List 
                                    id="travelCostsList"
                                    items="{
                                        path: '/travelCosts',
                                        templateShareable: false
                                    }"
                                    noDataText="{i18n>text.noTravelCosts}">
                                    <CustomListItem>
                                        <HBox justifyContent="SpaceBetween" alignItems="Center" width="100%">
                                            <VBox width="80%">
                                                <Text text="{fileName}" class="sapUiTinyMarginBottom"/>
                                                <Text text="{description}" class="sapUiTinyText"/>
                                                <Text text="Size: {fileSize}" class="sapUiTinyText"/>
                                            </VBox>
                                            <Button 
                                                icon="sap-icon://delete" 
                                                type="Transparent"
                                                press=".onDeleteFile"
                                                data:category="travelCosts"
                                                data:index="{index}"
                                                tooltip="{i18n>tooltip.deleteFile}"/>
                                        </HBox>
                                    </CustomListItem>
                                </List>
                            </VBox>
                        </Panel>

                        <!-- Stay Costs Section -->
                        <Panel headerText="{i18n>title.stayCosts}" >
                            <VBox class="sapUiSmallMargin">
                                <HBox justifyContent="SpaceBetween" alignItems="Center" class="sapUiTinyMarginBottom">
                                    <Label text="{i18n>text.uploadStayHint}"/>
                                    <Button 
                                        text="{i18n>button.addStayCost}" 
                                        icon="sap-icon://add"
                                        type="Emphasized"
                                        press=".onAddFile"
                                        data:category="stayCosts"
                                        tooltip="{i18n>tooltip.addStayCost}"/>
                                </HBox>
                                <List 
                                    id="stayCostsList"
                                    items="{
                                        path: '/stayCosts',
                                        templateShareable: false
                                    }"
                                    noDataText="{i18n>text.noStayCosts}">
                                    <CustomListItem>
                                        <HBox justifyContent="SpaceBetween" alignItems="Center" width="100%">
                                            <VBox width="80%">
                                                <Text text="{fileName}" class="sapUiTinyMarginBottom"/>
                                                <Text text="{description}" class="sapUiTinyText"/>
                                                <Text text="{= ${i18n>text.sizePrefix}.replace('{0}', ${fileSize}) }" class="sapUiTinyText"/>
                                            </VBox>
                                            <Button 
                                                icon="sap-icon://delete" 
                                                type="Transparent"
                                                press=".onDeleteFile"
                                                data:category="stayCosts"
                                                data:index="{index}"
                                                tooltip="{i18n>tooltip.deleteFile}"/>
                                        </HBox>
                                    </CustomListItem>
                                </List>
                            </VBox>
                        </Panel>

                        <!-- Submit Button -->
                        <HBox justifyContent="End" >
                            <Button 
                                id="submitButton"
                                text="{i18n>button.submitReimbursementRequest}" 
                                type="Success"
                                icon="sap-icon://accept"
                                press=".onSubmit"
                                tooltip="{i18n>tooltip.submit}"/>
                        </HBox>
                        
                    </VBox>
                </content>
            </Page>
        </detailPages>
    </SplitApp>
</mvc:View>
