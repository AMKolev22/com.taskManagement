<mvc:View controllerName="taskManagement.controller.MyTasks"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns="sap.m" displayBlock="true" height="100%">
    <SplitApp id="myTasksSplitApp" initialMaster="masterPage" initialDetail="detailPage">
        <masterPages>
            <Page id="masterPage">
                <content>
                    <FlexBox alignItems="Center" direction="Column" height="100%">
                        <core:Fragment fragmentName="taskManagement.view.fragments.Sidebar" type="XML" />
                    </FlexBox>
                </content>
            </Page>
        </masterPages>
        <detailPages>
            <Page id="detailPage">
                <customHeader>
                    <OverflowToolbar>
                        <Button icon="sap-icon://nav-back" type="Transparent" press="onNavBack" />
                        <ToolbarSpacer />
                        <Title text="{i18n>title.myTasks}" level="H2"/>
                        <ToolbarSpacer />
                        <Avatar
                            initials="{= ${userModel>/currentUser/firstName}.charAt(0) }"
                            press="onUserInfoPress"
                            displaySize="XS"
                            backgroundColor="Accent6"
                            tooltip="{userModel>/currentUser/firstName}"
                        />
                    </OverflowToolbar>
                </customHeader>
                <content>
                    <VBox class="sapUiMediumMargin">
                        <!-- Filter Bar -->
                        <OverflowToolbar>
                            <SearchField id="searchField" placeholder="{i18n>placeholder.searchMyTasks}" value="{filterModel>/searchQuery}" search="onSearch" liveChange="onSearch">
                                <layoutData>
                                    <OverflowToolbarLayoutData priority="NeverOverflow" shrinkable="true" />
                                </layoutData>
                            </SearchField>
                            <ToolbarSpacer />
                            <Select id="statusFilter" selectedKey="{filterModel>/statusFilter}" change="onFilterChange">
                                <layoutData>
                                    <OverflowToolbarLayoutData priority="NeverOverflow" />
                                </layoutData>
                                <items>
                                    <core:Item key="all" text="{i18n>filter.allStatus}"/>
                                    <core:Item key="PENDING_APPROVAL" text="{i18n>filter.status.pending}"/>
                                    <core:Item key="APPROVED" text="{i18n>filter.status.approved}"/>
                                    <core:Item key="REJECTED" text="{i18n>filter.status.rejected}"/>
                                    <core:Item key="PARTIALLY_REJECTED" text="{i18n>filter.status.partiallyRejected}"/>
                                </items>
                            </Select>
                        </OverflowToolbar>

                        <!-- Tasks List -->
                        <List id="myTasksList" items="{tasksModel>/filteredTasks}" growing="true" growingThreshold="20" noDataText="{i18n>text.noTasks}">
                            <CustomListItem type="Active" press="onTaskPress">
                                <HBox justifyContent="SpaceBetween" alignItems="Center" width="100%" class="sapUiSmallMarginTop">
                                    <HBox alignItems="Center">
                                        <layoutData>
                                            <FlexItemData growFactor="1" />
                                        </layoutData>
                                        <core:Icon src="{path: 'tasksModel>type', formatter: '.formatter.getRequestTypeIcon'}" color="{path: 'tasksModel>type', formatter: '.formatter.getRequestTypeColor'}" size="2rem" class="sapUiTinyMarginEnd" />
                                        <VBox>
                                            <HBox>
                                                <Text text="{tasksModel>requestId}" class="sapUiTinyMarginEnd" />
                                                <ObjectStatus text="{path: 'tasksModel>type', formatter: '.formatter.formatRequestType'}" state="Information" icon="{= ${tasksModel>type} === 'Vacation' ? 'sap-icon://general-leave-request' : '' }"/>
                                            </HBox>
                                            <Text text="{tasksModel>subject}" class="sapUiTinyMarginTop" />
                                            <Text text="{= ${i18n>text.submittedPrefix}.replace('{0}', ${path: 'tasksModel>submittedDate', formatter: '.formatter.formatDate'}) }" class="sapUiTinyMarginTop"/>

                                            <!-- Warning for Partially Rejected -->
                                            <MessageStrip text="{i18n>message.actionRequiredPartial}" type="Warning" showIcon="true" visible="{= ${tasksModel>status} === 'PARTIALLY_REJECTED' }" class="sapUiTinyMarginTop"/>
                                        </VBox>
                                    </HBox>
                                    <VBox alignItems="End">
                                        <ObjectStatus text="{path: 'tasksModel>status', formatter: '.formatter.formatStatus'}" state="{path: 'tasksModel>status', formatter: '.formatter.formatStatusState'}" class="sapUiTinyMarginEnd" />
                                        <Button text="{i18n>button.viewDetails}" type="Transparent" press="onViewTaskDetails" class="sapUiTinyMarginTop"/>

                                        <!-- Resubmit button for partially rejected tasks -->
                                        <Button text="{i18n>button.resubmit}" type="Emphasized" icon="sap-icon://upload" press="onResubmit" visible="{= ${tasksModel>status} === 'PARTIALLY_REJECTED' }" class="sapUiTinyMarginTop"/>
                                    </VBox>
                                </HBox>
                            </CustomListItem>
                        </List>
                    </VBox>
                </content>
            </Page>
        </detailPages>
    </SplitApp>
</mvc:View>

