<mvc:View
    controllerName="taskManagement.controller.ManagerDashboard"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns="sap.m"
    displayBlock="true"
    height="100%"
>
    <SplitApp
        id="managerSplitApp"
        initialMaster="masterPage"
        initialDetail="detailPage"
    >
        <masterPages>
            <Page id="masterPage">
                <content>
                    <FlexBox
                        alignItems="Center"
                        direction="Column"
                        height="100%"
                    >
                        <core:Fragment
                            fragmentName="taskManagement.view.fragments.Sidebar"
                            type="XML"
                        />
                    </FlexBox>
                </content>
            </Page>
        </masterPages>
        <detailPages>
            <Page id="detailPage">
                <customHeader>
                    <OverflowToolbar>
                        <Button
                            icon="sap-icon://nav-back"
                            type="Transparent"
                            press="onNavBack"
                            visible="{pageModel>/navBackVisible}"
                            class="sapUiHideOnDesktop sapUiHideOnTablet"
                        />
                        <ToolbarSpacer />
                        <Title
                            text="{i18n>title.managerDashboardPending}"
                            level="H2"
                        />
                        <ToolbarSpacer />
                        <Button
                            icon="sap-icon://refresh"
                            tooltip="{i18n>tooltip.refresh}"
                            press="onRefresh"
                            type="Transparent"
                        />
                        <Avatar
                            initials="{= ${userModel>/currentUser/firstName}.charAt(0) }"
                            press="onUserInfoPress"
                            displaySize="XS"
                            backgroundColor="Accent6"
                            tooltip="{userModel>/currentUser/firstName}"
                        />
                    </OverflowToolbar>
                </customHeader>
                <content>
                    <VBox class="sapUiMediumMarginTop">
                        <!-- Search and Filter Bar -->
                        <OverflowToolbar>
                            <SearchField
                                id="searchField"
                                placeholder="{i18n>placeholder.searchTasks}"
                                value="{filterModel>/searchQuery}"
                                search="onSearch"
                                liveChange="onSearch"
                            >
                                <layoutData>
                                    <OverflowToolbarLayoutData priority="NeverOverflow" shrinkable="true" />
                                </layoutData>
                            </SearchField>
                            <ToolbarSpacer />
                            <Select
                                id="typeFilter"
                                selectedKey="{filterModel>/typeFilter}"
                                change="onFilterChange"
                            >
                                <layoutData>
                                    <OverflowToolbarLayoutData priority="NeverOverflow" />
                                </layoutData>
                                <items>
                                    <core:Item key="all" text="{i18n>filter.allTypes}"/>
                                    <core:Item key="Vacation" text="{i18n>filter.type.vacation}"/>
                                    <core:Item key="Travel" text="{i18n>filter.type.travel}"/>
                                    <core:Item key="Equipment" text="{i18n>filter.type.equipment}"/>
                                </items>
                            </Select>
                            <Select
                                id="statusFilter"
                                selectedKey="{filterModel>/statusFilter}"
                                change="onFilterChange"
                                class="sapUiSmallMarginBegin"
                            >
                                <layoutData>
                                    <OverflowToolbarLayoutData priority="NeverOverflow" />
                                </layoutData>
                                <items>
                                    <core:Item key="all" text="{i18n>filter.allStatus}"/>
                                    <core:Item key="PENDING_APPROVAL" text="{i18n>filter.status.pending}"/>
                                    <core:Item key="APPROVED" text="{i18n>filter.status.approved}"/>
                                    <core:Item key="REJECTED" text="{i18n>filter.status.rejected}"/>
                                    <core:Item key="PARTIALLY_REJECTED" text="{i18n>filter.status.partiallyRejected}"/>
                                </items>
                            </Select>
                        </OverflowToolbar>

                        <!-- Pending Tasks Table -->
                        <Table
                             id="pendingTasksTable"
                             items="{dashboardModel>/filteredTasks}"
                             mode="None"
                             growing="true"
                             growingThreshold="20"
                             autoPopinMode="true"
                             popinLayout="GridSmall"
                             noDataText="{i18n>text.noTasks}"
                         >
                            <columns>
                                <Column width="4rem" importance="Low" popinDisplay="WithoutHeader">
                                    <Text text="" />
                                </Column>
                                <Column importance="High">
                                    <Text text="{i18n>column.requestId}" />
                                </Column>
                                <Column importance="Medium">
                                    <Text text="{i18n>column.type}" />
                                </Column>
                                <Column importance="Medium">
                                    <Text text="{i18n>column.from}" />
                                </Column>
                                <Column importance="Medium">
                                    <Text text="{i18n>column.subject}" />
                                </Column>
                                <Column importance="Medium">
                                    <Text text="{i18n>column.submitted}" />
                                </Column>
                                <Column importance="High">
                                    <Text text="{i18n>column.status}" />
                                </Column>
                                <Column
                                    hAlign="Center"
                                    importance="Medium"
                                    visible="{dashboardModel>/hasPending}"
                                >
                                    <Text text="{i18n>column.actions}" />
                                </Column>
                            </columns>
                            <items>
                                <ColumnListItem
                                    type="Active"
                                    press="onTaskPress"
                                >
                                    <cells>
                                        <core:Icon
                                            src="{path: 'dashboardModel>type', formatter: '.formatter.getRequestTypeIcon'}"
                                            color="{path: 'dashboardModel>type', formatter: '.formatter.getRequestTypeColor'}"
                                        />
                                        <Text text="{dashboardModel>requestId}" />
                                        <ObjectStatus text="{path: 'dashboardModel>type', formatter: '.formatter.formatRequestType'}" state="Information" />
                                        <Text text="{dashboardModel>submittedBy}" />
                                        <Text text="{dashboardModel>subject}" />
                                        <Text text="{path: 'dashboardModel>submittedDate', formatter: '.formatter.formatDate'}" />
                                        <ObjectStatus
                                            text="{path: 'dashboardModel>status', formatter: '.formatter.formatStatus'}"
                                            state="{path: 'dashboardModel>status', formatter: '.formatter.formatStatusState'}"
                                        />
                                        <HBox justifyContent="Center" alignItems="Center" width="100%" wrap="Wrap" visible="{= ${dashboardModel>status} === 'PENDING_APPROVAL' }">
                                            <Button icon="sap-icon://detail-view" type="Transparent" tooltip="{i18n>tooltip.viewDetails}" press="onViewDetails" class="sapUiTinyMarginEnd"/>
                                            <Button
                                                icon="sap-icon://accept"
                                                type="Accept"
                                                tooltip="{i18n>tooltip.approve}"
                                                press="onQuickApprove"
                                                class="sapUiTinyMarginEnd"
                                            />
                                            <Button
                                                icon="sap-icon://decline"
                                                type="Reject"
                                                tooltip="{i18n>tooltip.reject}"
                                                press="onQuickReject"
                                            />
                                        </HBox>
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </VBox>
                </content>
            </Page>
        </detailPages>
    </SplitApp>
</mvc:View>
