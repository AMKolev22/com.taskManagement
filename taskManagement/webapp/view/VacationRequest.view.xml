<mvc:View
    controllerName="taskManagement.controller.VacationRequest"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:form="sap.ui.layout.form"
    xmlns:unified="sap.ui.unified"
    xmlns:layout="sap.ui.layout"
    xmlns="sap.m"
    displayBlock="true"
    height="100%"
>
    <SplitApp
        id="vacationRequestSplitApp"
        initialMaster="masterPage"
        initialDetail="detailPage"
    >
        <masterPages>
            <Page id="masterPage">
                <content>
                    <FlexBox
                        alignItems="Stretch"
                        direction="Column"
                    >
                        <core:Fragment
                            fragmentName="taskManagement.view.fragments.Sidebar"
                            type="XML"
                        />

                        
                    </FlexBox>
                </content>
            </Page>
        </masterPages>
        <detailPages>
            <Page id="detailPage">
                <customHeader>
                    <OverflowToolbar>
                        <Button
                            icon="sap-icon://nav-back"
                            type="Transparent"
                            press="onNavBack"
                        />
                        <ToolbarSpacer />
                        <Title
                            text="New Vacation Request"
                            level="H2"
                        />
                        <ToolbarSpacer />
                    </OverflowToolbar>
                </customHeader>
                <content>
                    <layout:DynamicSideContent id="vacationDSC" containerQuery="true" sideContentFallDown="OnMinimumWidth" showSideContent="false">
                        <layout:mainContent>
                            <VBox class="sapUiMediumMargin">
                        <!-- Validation Message Strip -->
                        <MessageStrip
                            id="validationMessageStrip"
                            type="{requestModel>/validationMessageType}"
                            showIcon="true"
                            visible="{requestModel>/showValidationMessage}"
                            text="{requestModel>/validationMessage}"
                            class="sapUiSmallMarginBottom"
                        />
                        
                        <!-- Vacation Request Form -->
                        <form:SimpleForm
                            id="vacationRequestForm"
                            editable="true"
                            layout="ResponsiveGridLayout"
                            labelSpanXL="12"
                            labelSpanL="12"
                            labelSpanM="12"
                            labelSpanS="12"
                            emptySpanXL="0"
                            emptySpanL="0"
                            emptySpanM="0"
                            emptySpanS="0"
                            columnsXL="1"
                            columnsL="1"
                            columnsM="1"
                        >
                            <form:content>
                                <core:Title text="Leave Information" />

                                <Label
                                    text="Vacation Type"
                                    required="true"
                                />
                                <Select
                                    id="vacationType"
                                    selectedKey="{requestModel>/vacationType}"
                                    valueState="{requestModel>/validation/vacationTypeState}"
                                    valueStateText="{requestModel>/validation/vacationTypeMessage}"
                                    change="onVacationTypeChange"
                                >
                                    <items>
                                        <core:Item
                                            key="ANNUAL_LEAVE"
                                            text="Annual Leave"
                                        />
                                        <core:Item
                                            key="SICK_LEAVE"
                                            text="Sick Leave"
                                        />
                                        <!-- Only Annual and Sick leave are selectable per requirement -->
                                    </items>
                                </Select>

                                <Label
                                    text="Start Date"
                                    required="true"
                                />
                                <DatePicker
                                    id="startDate"
                                    value="{requestModel>/startDate}"
                                    valueState="{requestModel>/validation/startDateState}"
                                    valueStateText="{requestModel>/validation/startDateMessage}"
                                    change="onDateChange"
                                    minDate="{requestModel>/minDate}"
                                    width="100%"
                                />

                                <Label
                                    text="End Date"
                                    required="true"
                                />
                                <DatePicker
                                    id="endDate"
                                    value="{requestModel>/endDate}"
                                    valueState="{requestModel>/validation/endDateState}"
                                    valueStateText="{requestModel>/validation/endDateMessage}"
                                    change="onDateChange"
                                    minDate="{requestModel>/startDate}"
                                    width="100%"
                                />

                                <Label text="Duration" />
                                <Text
                                    text="{requestModel>/duration}"
                                    class="sapUiSmallMarginTop"
                                />

                                <core:Title text="Approver and Substitute" />

                                <Label
                                    text="Manager"
                                    required="true"
                                />
                                <HBox alignItems="Center" width="100%">
                                    <Select
                                        id="managerSelect"
                                        width="100%"
                                        selectedKey="{requestModel>/managerId}"
                                        valueState="{requestModel>/validation/managerState}"
                                        valueStateText="{requestModel>/validation/managerMessage}"
                                        items="{requestModel>/managers}"
                                        change="onManagerChange"
                                    >
                                        <core:Item
                                            key="{requestModel>userId}"
                                            text="{requestModel>firstName} {requestModel>lastName} ({requestModel>department})"
                                        />
                                        <layoutData>
                                            <FlexItemData growFactor="1"/>
                                        </layoutData>
                                    </Select>
                                    <Button
                                        icon="sap-icon://calendar"
                                        tooltip="View Manager Calendar"
                                        press="onViewManagerCalendar"
                                        type="Transparent"
                                        class="sapUiTinyMarginBegin"
                                    />
                                </HBox>

                                <Label
                                    text="Substitute"
                                    required="{
                                        parts: ['requestModel>/vacationType', 'requestModel>/startDate', 'requestModel>/endDate'],
                                        formatter: '.formatSubstituteRequired'
                                    }"
                                    visible="{
                                        parts: ['requestModel>/vacationType', 'requestModel>/startDate', 'requestModel>/endDate'],
                                        formatter: '.formatSubstituteRequired'
                                    }"
                                />
                                <HBox 
                                    alignItems="Center"
                                    width="100%"
                                    visible="{
                                        parts: ['requestModel>/vacationType', 'requestModel>/startDate', 'requestModel>/endDate'],
                                        formatter: '.formatShowSubstitute'
                                    }">
                                    <Select
                                        id="substituteSelect"
                                        width="100%"
                                        selectedKey="{requestModel>/substituteId}"
                                        valueState="{requestModel>/validation/substituteState}"
                                        valueStateText="{requestModel>/validation/substituteMessage}"
                                        items="{requestModel>/substitutes}"
                                        change="onSubstituteChange"
                                    >
                                        <core:Item
                                            key="{requestModel>userId}"
                                            text="{requestModel>firstName} {requestModel>lastName} ({requestModel>department})"
                                        />
                                        <layoutData>
                                            <FlexItemData growFactor="1"/>
                                        </layoutData>
                                    </Select>
                                    <Button
                                        icon="sap-icon://calendar"
                                        tooltip="View Substitute Calendar"
                                        press="onViewSubstituteCalendar"
                                        type="Transparent"
                                        class="sapUiTinyMarginBegin"
                                    />
                                </HBox>

                                <!-- Availability Warning Messages -->
                                <MessageStrip
                                    text="{i18n>error.managerNotAvailableMessage}"
                                    type="Error"
                                    showIcon="true"
                                    visible="{requestModel>/managerNotAvailable}"
                                    class="sapUiSmallMarginTop"
                                />

                                <MessageStrip
                                    text="{i18n>error.substituteNotAvailableMessage}"
                                    type="Error"
                                    showIcon="true"
                                    visible="{requestModel>/substituteNotAvailable}"
                                    class="sapUiSmallMarginTop"
                                />

                                <core:Title text="Leave Details" />

                                <Label
                                    text="Paid Leave"
                                />
                                <Switch
                                    id="paidSwitch"
                                    state="{requestModel>/paid}"
                                    customTextOn="Yes"
                                    customTextOff="No"
                                    enabled="{= ${requestModel>/vacationType} === 'ANNUAL_LEAVE'}"
                                    change="onPaidChange"
                                />

                                <core:Title text="Reason" />

                                <Label
                                    text="Reason for Request"
                                    required="true"
                                />
                                <TextArea
                                    id="reason"
                                    value="{requestModel>/reason}"
                                    valueState="{requestModel>/validation/reasonState}"
                                    valueStateText="{requestModel>/validation/reasonMessage}"
                                    rows="5"
                                    width="100%"
                                    placeholder="Please provide a reason for your vacation request..."
                                />

                                <!-- Attachments removed for new Vacation requests as per requirements -->
                            </form:content>
                        </form:SimpleForm>

                        <!-- Action Buttons -->
                        <HBox justifyContent="End" class="sapUiMediumMarginTop">
                            <Button text="Cancel" press="onCancel" class="sapUiTinyMarginEnd"/>
                            <Button text="Submit Request" type="Emphasized" press="onSubmit" icon="sap-icon://paper-plane"/>
                        </HBox>
                            </VBox>
                        </layout:mainContent>
                        <layout:sideContent>
                            <Panel headerText="Manager Availability" class="sapUiMediumMargin">
                                <headerToolbar>
                                    <Toolbar>
                                        <Title text="Manager Availability"/>
                                        <ToolbarSpacer/>
                                        <Button icon="sap-icon://decline" type="Transparent" tooltip="Close" press="onCloseCalendar"/>
                                    </Toolbar>
                                </headerToolbar>
                                <content>
                                    <unified:Calendar width="100%" class="sapUiSmallMarginTop" specialDates="{calendarModel>/availabilities}">
                                        <unified:specialDates>
                                            <unified:DateTypeRange startDate="{calendarModel>startDate}" endDate="{calendarModel>endDate}" type="Type01" tooltip="{calendarModel>reason}"/>
                                        </unified:specialDates>
                                    </unified:Calendar>
                                </content>
                            </Panel>
                        </layout:sideContent>
                    </layout:DynamicSideContent>
                </content>
            </Page>
        </detailPages>
    </SplitApp>
</mvc:View>

